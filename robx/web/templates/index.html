<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ROBX Web</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
    header { display: flex; align-items: center; gap: 12px; }
    button { padding: 8px 12px; cursor: pointer; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f3f3f3; text-align: left; }
    .buy { color: #0a7f17; font-weight: 600; }
    .sell { color: #b51212; font-weight: 600; }
    .hold { color: #666; font-weight: 600; }
  </style>
</head>
<body>
  <header>
    <h2>ROBX - Sinais</h2>
    <button id="runBtn">Executar agora</button>
    <span id="status"></span>
  </header>

  <table>
    <thead>
      <tr>
        <th>Ativo</th>
        <th>Timeframe</th>
        <th>Estratégia</th>
        <th>Sinal</th>
        <th>Confiança</th>
        <th>Preço</th>
        <th>Extras</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <script>
    const rows = document.getElementById('rows');
    const statusEl = document.getElementById('status');
    const runBtn = document.getElementById('runBtn');

    async function loadSignals() {
      const res = await fetch('/api/signals');
      const data = await res.json();
      render(data);
    }

    function render(items) {
      rows.innerHTML = '';
      for (const s of items) {
        const tr = document.createElement('tr');
        const actionClass = s.action === 'buy' ? 'buy' : (s.action === 'sell' ? 'sell' : 'hold');
        tr.innerHTML = `
          <td>${s.symbol}</td>
          <td>${s.timeframe}</td>
          <td>${s.strategy}</td>
          <td class="${actionClass}">${s.action.toUpperCase()}</td>
          <td>${s.confidence.toFixed(2)}</td>
          <td>${s.price.toFixed(2)}</td>
          <td><code>${JSON.stringify(s.extras)}</code></td>
        `;
        rows.appendChild(tr);
      }
    }

    runBtn.addEventListener('click', async () => {
      statusEl.textContent = 'Executando…';
      runBtn.disabled = true;
      try {
        const res = await fetch('/api/run', { method: 'POST' });
        const out = await res.json();
        statusEl.textContent = `Gerou ${out.count} sinal(is)`;
        await loadSignals();
      } catch (e) {
        statusEl.textContent = 'Erro ao executar';
      } finally {
        runBtn.disabled = false;
      }
    });

    loadSignals();
  </script>
</body>
</html>
